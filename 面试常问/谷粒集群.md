# 集群的目标

•高可用（**High** **Availability**），是当一台服务器停止服务后，对于业务及用户毫无影 响。 停止服务的原因可能由于网卡、路由器、机房、CPU负载过高、内存溢出、自 然灾害等不可预期的原因导致，在很多时候也称单点问题。

•突破数据量限制，一台服务器不能储存大量数据，需要多台分担，每个存储一部分， 共同存储完整个集群数据。最好能做到互相备份，即使单节点故障，也能在其他节点 找到数据。

•数据备份容灾，单点故障后，存储的数据仍然可以在别的地方拉起。（副本、备份）

•压力分担，由于多个服务器都能完成各自一部分工作，所以尽量的避免了单点压力的 存在

# 集群的基础形式

![image-20220322231509450](C:\Users\kgliu\AppData\Roaming\Typora\typora-user-images\image-20220322231509450.png)

主从复制：从节点复制主节点数据，保证跟主节点数据一样，好处主要是压力分担，如MySQL，如果5个机器，百万并发，一个机器就20万

主从调度：主调度从，如K8S

主从缺点：容量限制问题，如MySQL主存不下了，从也就没办法了。为了突破数据量的限制，用分片式。如Redis1号存1~10000，2号存10001~20000，3号存20001~30000，还可以做片区之间备份，如1号存1~10000，还存20001~30000，3号存20001~30000，还存10001~20000，这样有备份，不怕丢失

# MySQL集群

在MySQL里面，主从同步不可缺，可做到压力分担，读写分离。缺点：同步时有延迟，网络不佳时尤甚

主宕掉后：1、从提为主，2、主做备份

企业用的多的解决方案：

![image-20220322235526077](C:\Users\kgliu\AppData\Roaming\Typora\typora-user-images\image-20220322235526077.png)



主节点挂掉，不提升从节点，而是用另一个备用

## 主从复制

![image-20220323105813254](C:\Users\kgliu\AppData\Roaming\Typora\typora-user-images\image-20220323105813254.png)

![image-20220323105843237](C:\Users\kgliu\AppData\Roaming\Typora\typora-user-images\image-20220323105843237.png)

![image-20220323105951678](C:\Users\kgliu\AppData\Roaming\Typora\typora-user-images\image-20220323105951678.png)

![image-20220323110108749](C:\Users\kgliu\AppData\Roaming\Typora\typora-user-images\image-20220323110108749.png)

![image-20220323111707202](C:\Users\kgliu\AppData\Roaming\Typora\typora-user-images\image-20220323111707202.png)

![image-20220323112827434](C:\Users\kgliu\AppData\Roaming\Typora\typora-user-images\image-20220323112827434.png)

![image-20220323113020194](C:\Users\kgliu\AppData\Roaming\Typora\typora-user-images\image-20220323113020194.png)![image-20220323113048215](C:\Users\kgliu\AppData\Roaming\Typora\typora-user-images\image-20220323113048215.png)

![image-20220323112915583](C:\Users\kgliu\AppData\Roaming\Typora\typora-user-images\image-20220323112915583.png)![image-20220323124036748](C:\Users\kgliu\AppData\Roaming\Typora\typora-user-images\image-20220323124036748.png)

![image-20220323123644881](C:\Users\kgliu\AppData\Roaming\Typora\typora-user-images\image-20220323123644881.png)

![image-20220323124141628](C:\Users\kgliu\AppData\Roaming\Typora\typora-user-images\image-20220323124141628.png)

Position是431，但是用0也可，0会直接全部扫描

![image-20220323124243787](C:\Users\kgliu\AppData\Roaming\Typora\typora-user-images\image-20220323124243787.png)

![image-20220323124435631](C:\Users\kgliu\AppData\Roaming\Typora\typora-user-images\image-20220323124435631.png)

![image-20220323124509694](C:\Users\kgliu\AppData\Roaming\Typora\typora-user-images\image-20220323124509694.png)

# 分库分表

主从复制不能解决单表过大的问题，因此引入分库分表

![image-20220323125438584](C:\Users\kgliu\AppData\Roaming\Typora\typora-user-images\image-20220323125438584.png)

![image-20220323125902098](C:\Users\kgliu\AppData\Roaming\Typora\typora-user-images\image-20220323125902098.png)

![image-20220323125956544](C:\Users\kgliu\AppData\Roaming\Typora\typora-user-images\image-20220323125956544.png)

下载后解压

![image-20220323130128145](C:\Users\kgliu\AppData\Roaming\Typora\typora-user-images\image-20220323130128145.png)

![image-20220323131031285](C:\Users\kgliu\AppData\Roaming\Typora\typora-user-images\image-20220323131031285.png)

![image-20220323131057955](C:\Users\kgliu\AppData\Roaming\Typora\typora-user-images\image-20220323131057955.png)

![image-20220323131130805](C:\Users\kgliu\AppData\Roaming\Typora\typora-user-images\image-20220323131130805.png)

![image-20220323131200773](C:\Users\kgliu\AppData\Roaming\Typora\typora-user-images\image-20220323131200773.png)

![image-20220323131257710](C:\Users\kgliu\AppData\Roaming\Typora\typora-user-images\image-20220323131257710.png)

![image-20220323131456717](C:\Users\kgliu\AppData\Roaming\Typora\typora-user-images\image-20220323131456717.png)

![image-20220323132906034](C:\Users\kgliu\AppData\Roaming\Typora\typora-user-images\image-20220323132906034.png)

![image-20220323132110451](C:\Users\kgliu\AppData\Roaming\Typora\typora-user-images\image-20220323132110451.png)

![image-20220323132754265](C:\Users\kgliu\AppData\Roaming\Typora\typora-user-images\image-20220323132754265.png)![image-20220323143054826](C:\Users\kgliu\AppData\Roaming\Typora\typora-user-images\image-20220323143054826.png)

![image-20220323143028764](C:\Users\kgliu\AppData\Roaming\Typora\typora-user-images\image-20220323143028764.png)

![image-20220323143150596](C:\Users\kgliu\AppData\Roaming\Typora\typora-user-images\image-20220323143150596.png)

![image-20220323143224642](C:\Users\kgliu\AppData\Roaming\Typora\typora-user-images\image-20220323143224642.png)

![image-20220323143341011](C:\Users\kgliu\AppData\Roaming\Typora\typora-user-images\image-20220323143341011.png)

![image-20220323143400467](C:\Users\kgliu\AppData\Roaming\Typora\typora-user-images\image-20220323143400467.png)

![image-20220323143511611](C:\Users\kgliu\AppData\Roaming\Typora\typora-user-images\image-20220323143511611.png)

![image-20220323143649857](C:\Users\kgliu\AppData\Roaming\Typora\typora-user-images\image-20220323143649857.png)

![image-20220323143757177](C:\Users\kgliu\AppData\Roaming\Typora\typora-user-images\image-20220323143757177.png)

![image-20220323143928400](C:\Users\kgliu\AppData\Roaming\Typora\typora-user-images\image-20220323143928400.png)

![image-20220323144015680](C:\Users\kgliu\AppData\Roaming\Typora\typora-user-images\image-20220323144015680.png)

![image-20220323144134357](C:\Users\kgliu\AppData\Roaming\Typora\typora-user-images\image-20220323144134357.png)

![image-20220323144223499](C:\Users\kgliu\AppData\Roaming\Typora\typora-user-images\image-20220323144223499.png)

至于在库里的哪个表，看order_id对2求余，偶数的话在0表，奇数的话在1表。

sharding-proxy自己来写SQL

# Redis集群

客户端分区：如jedis。客户端分区对如果一台挂了就没办法了

![image-20220323144918049](C:\Users\kgliu\AppData\Roaming\Typora\typora-user-images\image-20220323144918049.png)

![image-20220323145051830](C:\Users\kgliu\AppData\Roaming\Typora\typora-user-images\image-20220323145051830.png)

![image-20220323145208262](C:\Users\kgliu\AppData\Roaming\Typora\typora-user-images\image-20220323145208262.png)

![image-20220323145309426](C:\Users\kgliu\AppData\Roaming\Typora\typora-user-images\image-20220323145309426.png)

![image-20220323145958486](C:\Users\kgliu\AppData\Roaming\Typora\typora-user-images\image-20220323145958486.png)

![image-20220323150020911](C:\Users\kgliu\AppData\Roaming\Typora\typora-user-images\image-20220323150020911.png)

![image-20220323150039903](C:\Users\kgliu\AppData\Roaming\Typora\typora-user-images\image-20220323150039903.png)

![image-20220323150147222](C:\Users\kgliu\AppData\Roaming\Typora\typora-user-images\image-20220323150147222.png)
![image-20220312230151637](C:\Users\kgliu\AppData\Roaming\Typora\typora-user-images\image-20220312230151637.png)

![image-20220323150645095](C:\Users\kgliu\AppData\Roaming\Typora\typora-user-images\image-20220323150645095.png)

![image-20220323150724585](C:\Users\kgliu\AppData\Roaming\Typora\typora-user-images\image-20220323150724585.png)


![image-20220323150846062](C:\Users\kgliu\AppData\Roaming\Typora\typora-user-images\image-20220323150846062.png)

![image-20220323151258660](C:\Users\kgliu\AppData\Roaming\Typora\typora-user-images\image-20220323151258660.png)

![image-20220323151551081](C:\Users\kgliu\AppData\Roaming\Typora\typora-user-images\image-20220323151551081.png)

![image-20220323151620505](C:\Users\kgliu\AppData\Roaming\Typora\typora-user-images\image-20220323151620505.png)

![image-20220323151736792](C:\Users\kgliu\AppData\Roaming\Typora\typora-user-images\image-20220323151736792.png)

![image-20220323152022034](C:\Users\kgliu\AppData\Roaming\Typora\typora-user-images\image-20220323152022034.png)

![image-20220323152102737](C:\Users\kgliu\AppData\Roaming\Typora\typora-user-images\image-20220323152102737.png)

![image-20220323152119329](C:\Users\kgliu\AppData\Roaming\Typora\typora-user-images\image-20220323152119329.png)

![image-20220323152132467](C:\Users\kgliu\AppData\Roaming\Typora\typora-user-images\image-20220323152132467.png)

![image-20220323152213050](C:\Users\kgliu\AppData\Roaming\Typora\typora-user-images\image-20220323152213050.png)

![image-20220323152251219](C:\Users\kgliu\AppData\Roaming\Typora\typora-user-images\image-20220323152251219.png)

![image-20220323152309888](C:\Users\kgliu\AppData\Roaming\Typora\typora-user-images\image-20220323152309888.png)

![image-20220323152501562](C:\Users\kgliu\AppData\Roaming\Typora\typora-user-images\image-20220323152501562.png)

![image-20220323152551361](C:\Users\kgliu\AppData\Roaming\Typora\typora-user-images\image-20220323152551361.png)

![image-20220323152626359](C:\Users\kgliu\AppData\Roaming\Typora\typora-user-images\image-20220323152626359.png)

![image-20220323152648120](C:\Users\kgliu\AppData\Roaming\Typora\typora-user-images\image-20220323152648120.png)

